<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Multi cluster networking with Cilium Cluster Mesh</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/blog/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/blog/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/blog/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="You'll find all my tech posts here" />
    <link rel="shortcut icon" href="/blog//assets/images/favicon.png" type="image/png" />
    <link rel="canonical" href="/blog/multi-cluster-networking-with-cilium-cluster-mesh" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Nomad's Blog" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Multi cluster networking with Cilium Cluster Mesh" />
    <meta property="og:description" content="As organizations increasingly adopt distributed architectures and scale their Kubernetes deployments, the need for robust networking and security solutions that can seamlessly operate across multiple clusters becomes paramount. In this blog, we will go through how you can use Cilium Cluster Mesh to effectively manage a fleet of Kubernetes clusters" />
    <meta property="og:url" content="/blog/multi-cluster-networking-with-cilium-cluster-mesh" />
    <meta property="og:image" content="/blog/assets/images/cilium.jpg" />
    <meta property="article:publisher" content="https://www.facebook.com/lahiru97udayanga" />
    <meta property="article:author" content="https://www.facebook.com/lahiru97udayanga" />
    <meta property="article:published_time" content="2024-05-17T00:00:00+00:00" />
    <meta property="article:modified_time" content="2024-05-17T00:00:00+00:00" />
    <meta property="article:tag" content="Tech" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Multi cluster networking with Cilium Cluster Mesh" />
    <meta name="twitter:description" content="As organizations increasingly adopt distributed architectures and scale their Kubernetes deployments, the need for robust networking and security solutions that can seamlessly operate across multiple clusters becomes paramount. In this blog, we will go through how you can use Cilium Cluster Mesh to effectively manage a fleet of Kubernetes clusters" />
    <meta name="twitter:url" content="/blog/" />
    <meta name="twitter:image" content="/blog/assets/images/cilium.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Nomad's Blog" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Tech" />
    <meta name="twitter:site" content="@NomadXDDDD" />
    <meta name="twitter:creator" content="@NomadXDDDD" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Nomad's Blog",
        "logo": "/blog//assets/images/blog-icon.png"
    },
    "url": "/blog/multi-cluster-networking-with-cilium-cluster-mesh",
    "image": {
        "@type": "ImageObject",
        "url": "/blog/assets/images/cilium.jpg",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "/blog/multi-cluster-networking-with-cilium-cluster-mesh"
    },
    "description": "As organizations increasingly adopt distributed architectures and scale their Kubernetes deployments, the need for robust networking and security solutions that can seamlessly operate across multiple clusters becomes paramount. In this blog, we will go through how you can use Cilium Cluster Mesh to effectively manage a fleet of Kubernetes clusters"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Multi cluster networking with Cilium Cluster Mesh" href="/blog/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="/blog/"><img src="/blog//assets/images/blog-icon.png" alt="Nomad's Blog" /></a>
            
        
        
            <ul class="nav" role="menu">
  <li class="nav-getting-started" role="menuitem">
    <a href="/blog/tag/tech/">Tech</a>
  </li>
  <li class="nav-home" role="menuitem">
    <a href="/blog/tag/random/">Random</a>
  </li>
  <li class="nav-try-ghost" role="menuitem">
    <a href="/blog/tag/travel/">Travel</a>
  </li>
  <li class="nav-about" role="menuitem">
    <a href="/blog/about/">About</a>
  </li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
                <a class="social-link social-link-fb" href="https://facebook.com/lahiru97udayanga" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
</a>
            
            
                <a class="social-link social-link-tw" href="https://twitter.com/NomadXDDDD" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
            
        </div>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-tech post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="17 May 2024">17 May 2024</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/blog/tag/tech/'>TECH</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Multi cluster networking with Cilium Cluster Mesh</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/blog/assets/images/cilium.jpg)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>As organizations increasingly adopt distributed architectures and scale their Kubernetes deployments, the need for robust networking and security solutions that can seamlessly operate across multiple clusters becomes paramount. In this blog, we will go through how you can use Cilium Cluster Mesh to effectively manage a fleet of Kubernetes clusters spanning across availability zones or regions, thereby achieving unparalleled levels of high availability and fault tolerance across your infrastructure.</p>

<h2 id="-cilium-cluster-mesh-in-a-nutshell-">üêù Cilium Cluster Mesh in a nutshell üêù</h2>

<p>Cilium Cluster Mesh allows you to connect the networks of multiple clusters in such as way that pods in each cluster can discover and access services in all other clusters of the mesh, provided all the clusters run Cilium as their CNI. This allows effectively joining multiple clusters into a large unified network, regardless of the Kubernetes distribution or location each of them is running.</p>

<p>This is done by deploying an additional API server called <code class="language-plaintext highlighter-rouge">clustermesh-apiserver</code> to synchronize the shared state among the kubernetes clusters. Each kubernetes cluster holds its state in the etcd and the kubernetes clusters in the cluster mesh can access other cluster‚Äôs state via the <code class="language-plaintext highlighter-rouge">clustermesh-apiserver</code>. For this each cluster should expose its <code class="language-plaintext highlighter-rouge">clustermesh-apiserver</code> as a Load balancer service. Cilium agents running in the kubernetes clusters connect to the <code class="language-plaintext highlighter-rouge">clustermesh-apiserver</code> of other clusters, watch for changes and replicate the multi-cluster relevant state into their own cluster.</p>

<p>Cilium Cluster Mesh provides the following features as stated in the Cilium documentation.</p>

<ul>
  <li>Pod IP routing across multiple Kubernetes clusters at native performance via tunneling or direct-routing without requiring any gateways or proxies.</li>
  <li>Transparent service discovery with standard Kubernetes services and coredns/kube-dns.</li>
  <li>Network policy enforcement spanning multiple clusters. Policies can be specified as Kubernetes NetworkPolicy resource or the extended CiliumNetworkPolicy CRD.</li>
  <li>Transparent encryption for all communication between nodes in the local cluster as well as across cluster boundaries.</li>
</ul>

<h2 id="time-to-get-our-hands-dirty-">Time to get our hands dirty‚Ä¶. üë®‚Äçüîß</h2>

<p>In this blog, we are going to deploy the following setup in your laptop using <code class="language-plaintext highlighter-rouge">kind (Kubernetes IN Docker)</code> and demonstrate the multi cluster load balancing and fault tolerance capabilities supported by Cilium Cluster Mesh.</p>

<p>The setup consists of 2 kubernetes clusters which are named as US and EU for ease of relating to real world scenario of multi region clusters. We are going to install Cilium in both of the clusters and then enable Cilium Cluster Mesh on both. Then we are going to deploy a hello world application in both of the clusters along with a busybox pod to access the application within the cluster. Then we are going to make the hello world service accessible across clusters enabling load balancing across clusters. Finally we are going to use service affinity rules in Cilium to demonstrate the fault tolerant capabilities across clusters.</p>

<p align="center">
  <img alt="Kubernetes Custom Controllers" src="assets/images/multi-cluster.png" />
    <em>Multi cluster networking</em>
</p>

<h3 id="1-create-two-kubernetes-clusters-using-kind">1. Create two kubernetes clusters using kind.</h3>

<blockquote>
  <p>Note: We will be using 3 terminals for the hands on lab. Terminal 1 has access to the US cluster and the Terminal 2 has access to the EU cluster. Terminal 3 has access to the both clusters.</p>
</blockquote>

<ul>
  <li>Create a new directory to host the kubernetes manifests. Let‚Äôs name it as <code class="language-plaintext highlighter-rouge">cilium-cluster-mesh</code>.</li>
  <li>Open a terminal session (Terminal 1) and set the environment variable <code class="language-plaintext highlighter-rouge">KUBECONFIG</code> to <code class="language-plaintext highlighter-rouge">export KUBECONFIG=./kubeconfig-us.yaml</code></li>
  <li>Create a file with the following content and save it as <code class="language-plaintext highlighter-rouge">kind-us-cluster.yaml</code></li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kind.x-k8s.io/v1alpha4</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Cluster</span>
<span class="na">networking</span><span class="pi">:</span>
  <span class="na">disableDefaultCNI</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">podSubnet</span><span class="pi">:</span> <span class="s">10.1.0.0/16</span>
  <span class="na">serviceSubnet</span><span class="pi">:</span> <span class="s">172.20.1.0/24</span>
<span class="na">nodes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">role</span><span class="pi">:</span> <span class="s">control-plane</span>
    <span class="na">extraPortMappings</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">32042</span>
        <span class="na">hostPort</span><span class="pi">:</span> <span class="m">32042</span>
      <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">31234</span>
        <span class="na">hostPort</span><span class="pi">:</span> <span class="m">31234</span>
      <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">31235</span>
        <span class="na">hostPort</span><span class="pi">:</span> <span class="m">31235</span>
  <span class="pi">-</span> <span class="na">role</span><span class="pi">:</span> <span class="s">worker</span>
  <span class="pi">-</span> <span class="na">role</span><span class="pi">:</span> <span class="s">worker</span>
</code></pre></div></div>

<ul>
  <li>Execute the following command to create the US cluster. If the cluster creation is successful, following logs can be seen.</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># US cluster (Terminal 1)</span>
‚ûú kind create cluster <span class="nt">--name</span> us <span class="nt">--config</span> kind-us-cluster.yaml

Creating cluster <span class="s2">"us"</span> ...
 ‚úì Ensuring node image <span class="o">(</span>kindest/node:v1.27.3<span class="o">)</span> üñº
 ‚úì Preparing nodes üì¶ üì¶ üì¶
 ‚úì Writing configuration üìú
 ‚úì Starting control-plane üïπÔ∏è
 ‚úì Installing StorageClass üíæ
 ‚úì Joining worker nodes üöú
Set kubectl context to <span class="s2">"kind-us"</span>
You can now use your cluster with:

kubectl cluster-info <span class="nt">--context</span> kind-us

Not sure what to <span class="k">do </span>next? üòÖ  Check out https://kind.sigs.k8s.io/docs/user/quick-start/

</code></pre></div></div>

<ul>
  <li>Next open a new terminal (Terminal 2) and set the environment variable <code class="language-plaintext highlighter-rouge">KUBECONFIG</code> to <code class="language-plaintext highlighter-rouge">export KUBECONFIG=./kubeconfig-eu.yaml</code></li>
  <li>Create a file with the following content and save it as <code class="language-plaintext highlighter-rouge">kind-eu-cluster.yaml</code></li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kind.x-k8s.io/v1alpha4</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Cluster</span>
<span class="na">networking</span><span class="pi">:</span>
  <span class="na">disableDefaultCNI</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">podSubnet</span><span class="pi">:</span> <span class="s">10.2.0.0/16</span>
  <span class="na">serviceSubnet</span><span class="pi">:</span> <span class="s">172.20.2.0/24</span>
<span class="na">nodes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">role</span><span class="pi">:</span> <span class="s">control-plane</span>
  <span class="pi">-</span> <span class="na">role</span><span class="pi">:</span> <span class="s">worker</span>
  <span class="pi">-</span> <span class="na">role</span><span class="pi">:</span> <span class="s">worker</span>
</code></pre></div></div>

<ul>
  <li>Execute the following command to create the EU cluster. If the cluster creation is successful, following logs can be seen.</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># EU cluster (Terminal 2)</span>
‚ûú kind create cluster <span class="nt">--name</span> eu <span class="nt">--config</span> kind-eu-cluster.yaml

Creating cluster <span class="s2">"eu"</span> ...
 ‚úì Ensuring node image <span class="o">(</span>kindest/node:v1.27.3<span class="o">)</span> üñº
 ‚úì Preparing nodes üì¶ üì¶ üì¶
 ‚úì Writing configuration üìú
 ‚úì Starting control-plane üïπÔ∏è
 ‚úì Installing StorageClass üíæ
 ‚úì Joining worker nodes üöú
Set kubectl context to <span class="s2">"kind-eu"</span>
You can now use your cluster with:

kubectl cluster-info <span class="nt">--context</span> kind-eu

Not sure what to <span class="k">do </span>next? üòÖ  Check out https://kind.sigs.k8s.io/docs/user/quick-start/

</code></pre></div></div>

<h3 id="2-install-cilium-cni-in-the-two-clusters">2. Install Cilium CNI in the two clusters.</h3>

<ul>
  <li>In the terminal 1 (US), execute the following command to install the Cilium CNI in the US cluster.</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># US cluster (Terminal 1)</span>
cilium <span class="nb">install</span> <span class="se">\</span>
  <span class="nt">--set</span> cluster.name<span class="o">=</span>us <span class="se">\</span>
  <span class="nt">--set</span> cluster.id<span class="o">=</span>1 <span class="se">\</span>
  <span class="nt">--set</span> ipam.mode<span class="o">=</span>kubernetes

üîÆ Auto-detected Kubernetes kind: kind
‚ú® Running <span class="s2">"kind"</span> validation checks
‚úÖ Detected kind version <span class="s2">"0.20.0"</span>
‚ÑπÔ∏è  Using Cilium version 1.15.4
‚ÑπÔ∏è  Using cluster name <span class="s2">"eu"</span>
üîÆ Auto-detected kube-proxy has been installed
</code></pre></div></div>

<ul>
  <li>Execute the command <code class="language-plaintext highlighter-rouge">cilium status</code> to check the status of the Cilium installation.</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># US cluster (Terminal 1)</span>
‚ûú cilium status   
    /¬Ø¬Ø<span class="se">\</span>
 /¬Ø¬Ø<span class="se">\_</span>_/¬Ø¬Ø<span class="se">\ </span>   Cilium:             OK
 <span class="se">\_</span>_/¬Ø¬Ø<span class="se">\_</span>_/    Operator:           OK
 /¬Ø¬Ø<span class="se">\_</span>_/¬Ø¬Ø<span class="se">\ </span>   Envoy DaemonSet:    disabled <span class="o">(</span>using embedded mode<span class="o">)</span>
 <span class="se">\_</span>_/¬Ø¬Ø<span class="se">\_</span>_/    Hubble Relay:       disabled
    <span class="se">\_</span>_/       ClusterMesh:        disabled

Deployment             cilium-operator    Desired: 1, Ready: 1/1, Available: 1/1
DaemonSet              cilium             Desired: 3, Ready: 3/3, Available: 3/3
Containers:            cilium             Running: 3
                       cilium-operator    Running: 1
Cluster Pods:          3/3 managed by Cilium
Helm chart version:    
Image versions         cilium             quay.io/cilium/cilium:v1.15.4@sha256:b760a4831f5aab71c711f7537a107b751d0d0ce90dd32d8b358df3c5da385426: 3
                       cilium-operator    quay.io/cilium/operator-generic:v1.15.4@sha256:404890a83cca3f28829eb7e54c1564bb6904708cdb7be04ebe69c2b60f164e9a: 1
</code></pre></div></div>

<ul>
  <li>In the terminal 2 (EU), execute the following command to install the Cilium CNI in the EU cluster.</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># EU cluster (Terminal 2)</span>
cilium <span class="nb">install</span> <span class="se">\</span>
  <span class="nt">--set</span> cluster.name<span class="o">=</span>eu <span class="se">\</span>
  <span class="nt">--set</span> cluster.id<span class="o">=</span>2 <span class="se">\</span>
  <span class="nt">--set</span> ipam.mode<span class="o">=</span>kubernetes

üîÆ Auto-detected Kubernetes kind: kind
‚ú® Running <span class="s2">"kind"</span> validation checks
‚úÖ Detected kind version <span class="s2">"0.20.0"</span>
‚ÑπÔ∏è  Using Cilium version 1.15.4
‚ÑπÔ∏è  Using cluster name <span class="s2">"eu"</span>
üîÆ Auto-detected kube-proxy has been installed
</code></pre></div></div>

<p>Now if you followed the instructions upto this point correctly, you would have 2 kubernetes clusters up and running in your laptop with Cilium installed as the CNI.</p>

<h3 id="3-enable-cilium-cluster-mesh-in-both-clusters">3. Enable Cilium Cluster Mesh in both clusters</h3>

<p>Next we are going to enable Cilium Cluster Mesh in both US and EU clusters. This will deploy an additional deployment for the <code class="language-plaintext highlighter-rouge">clustermesh-apiserver</code> in both of the clusters.</p>

<p>Cilium agents running in the EU cluster will use this <code class="language-plaintext highlighter-rouge">clustermesh-apiserver</code> in the US cluster to replicate the states of US cluster to its own EU cluster and vice versa. Therefore this <code class="language-plaintext highlighter-rouge">clustermesh-apiserver</code> should be exposed as a Load balancer service for accessing outside the cluster. But for demonstrating purposes, we are going to expose the <code class="language-plaintext highlighter-rouge">clustermesh-apiserver</code> as a NodePort service as we don‚Äôt have dynamic load balancers available. This is not recommended for production use cases as the service becomes unavailable when the node goes down.</p>

<p>To enable <code class="language-plaintext highlighter-rouge">clustermesh-apiserver</code> run the following command in both Terminal 1 (US) and Terminal 2 (EU).</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># US cluster (Terminal 1) &amp; EU cluster (Terminal 2)</span>
cilium clustermesh <span class="nb">enable</span> <span class="nt">--service-type</span> NodePort
</code></pre></div></div>

<p>If you execute the <code class="language-plaintext highlighter-rouge">cilium status</code> command now, you‚Äôll notice that the <code class="language-plaintext highlighter-rouge">ClusterMesh</code> status is changed from <code class="language-plaintext highlighter-rouge">disabled</code> to <code class="language-plaintext highlighter-rouge">OK</code>.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># US cluster (Terminal 1) &amp; EU cluster (Terminal 2)</span>
‚ûú cilium status                                    
    /¬Ø¬Ø<span class="se">\</span>
 /¬Ø¬Ø<span class="se">\_</span>_/¬Ø¬Ø<span class="se">\ </span>   Cilium:             OK
 <span class="se">\_</span>_/¬Ø¬Ø<span class="se">\_</span>_/    Operator:           OK
 /¬Ø¬Ø<span class="se">\_</span>_/¬Ø¬Ø<span class="se">\ </span>   Envoy DaemonSet:    disabled <span class="o">(</span>using embedded mode<span class="o">)</span>
 <span class="se">\_</span>_/¬Ø¬Ø<span class="se">\_</span>_/    Hubble Relay:       OK
    <span class="se">\_</span>_/       ClusterMesh:        OK

DaemonSet              cilium                   Desired: 3, Ready: 3/3, Available: 3/3
Deployment             clustermesh-apiserver    Desired: 1, Ready: 1/1, Available: 1/1
Deployment             hubble-relay             Desired: 1, Ready: 1/1, Available: 1/1
Deployment             hubble-ui                Desired: 1, Ready: 1/1, Available: 1/1
Deployment             cilium-operator          Desired: 1, Ready: 1/1, Available: 1/1
Containers:            cilium-operator          Running: 1
                       cilium                   Running: 3
                       hubble-relay             Running: 1
                       hubble-ui                Running: 1
                       clustermesh-apiserver    Running: 1
Cluster Pods:          6/6 managed by Cilium
Helm chart version:    
Image versions         cilium                   quay.io/cilium/cilium:v1.15.4@sha256:b760a4831f5aab71c711f7537a107b751d0d0ce90dd32d8b358df3c5da385426: 3
                       hubble-relay             quay.io/cilium/hubble-relay:v1.15.4@sha256:03ad857feaf52f1b4774c29614f42a50b370680eb7d0bfbc1ae065df84b1070a: 1
                       hubble-ui                quay.io/cilium/hubble-ui:v0.13.0@sha256:7d663dc16538dd6e29061abd1047013a645e6e69c115e008bee9ea9fef9a6666: 1
                       hubble-ui                quay.io/cilium/hubble-ui-backend:v0.13.0@sha256:1e7657d997c5a48253bb8dc91ecee75b63018d16ff5e5797e5af367336bc8803: 1
                       clustermesh-apiserver    quay.io/cilium/clustermesh-apiserver:v1.15.4@sha256:3fadf85d2aa0ecec09152e7e2d57648bda7e35bdc161b25ab54066dd4c3b299c: 2
                       cilium-operator          quay.io/cilium/operator-generic:v1.15.4@sha256:404890a83cca3f28829eb7e54c1564bb6904708cdb7be04ebe69c2b60f164e9a: 1
</code></pre></div></div>

<p>Now if you execute <code class="language-plaintext highlighter-rouge">kubectl get pods -A</code>, you‚Äôll notice a new pod is created for the <code class="language-plaintext highlighter-rouge">clustermesh-apiserver</code>.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># US cluster (Terminal 1) &amp; EU cluster (Terminal 2)</span>
‚ûú kubectl get pods <span class="nt">-A</span>

NAMESPACE            NAME                                         READY   STATUS      RESTARTS   AGE
kube-system          cilium-5glrm                                 1/1     Running     0          4m8s
kube-system          cilium-operator-5d8fb68868-sn9k5             1/1     Running     0          4m8s
kube-system          cilium-rnpmp                                 1/1     Running     0          4m8s
kube-system          cilium-tfjwr                                 1/1     Running     0          4m8s
kube-system          clustermesh-apiserver-68b6c7cc6d-224tw       0/2     Init:0/1    0          14s
kube-system          clustermesh-apiserver-generate-certs-hmpdc   0/1     Completed   0          14s
kube-system          coredns-5d78c9869d-d8drc                     1/1     Running     0          6m36s
kube-system          coredns-5d78c9869d-f85p5                     1/1     Running     0          6m36s
kube-system          etcd-us-control-plane                        1/1     Running     0          6m50s
kube-system          hubble-relay-64d7c9bb65-zwcfk                1/1     Running     0          79s
kube-system          hubble-ui-7b4457996f-pzhtf                   2/2     Running     0          79s
kube-system          kube-apiserver-us-control-plane              1/1     Running     0          6m52s
kube-system          kube-controller-manager-us-control-plane     1/1     Running     0          6m49s
kube-system          kube-proxy-nfmw2                             1/1     Running     0          6m30s
kube-system          kube-proxy-pmgnx                             1/1     Running     0          6m36s
kube-system          kube-proxy-twjbc                             1/1     Running     0          6m29s
kube-system          kube-scheduler-us-control-plane              1/1     Running     0          6m49s
local-path-storage   local-path-provisioner-6bc4bddd6b-qxk2z      1/1     Running     0          6m36s
</code></pre></div></div>

<p>If you followed everything upto to this point, you would have 2 kubernetes clusters with Cilium installed as the CNI and clustermesh enabled in both the clusters. Next we need to connect the two clusters.</p>

<h3 id="4-connect-the-two-clusters">4. Connect the two clusters</h3>

<p>To connect the two clusters, we need to use the global terminal with access to both the clusters. (Terminal 3)</p>

<ul>
  <li>Open the terminal 3 and execute the following command to merge the two contexts of the US and EU clusters.</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Global terminal (Terminal 3)</span>
<span class="nv">KUBECONFIG</span><span class="o">=</span>./kubeconfig-us.yaml:./kubeconfig-eu.yaml 
kubectl config view <span class="nt">--flatten</span> <span class="o">&gt;</span> merged-kubeconfig.yaml
</code></pre></div></div>
<ul>
  <li>Next set the <code class="language-plaintext highlighter-rouge">KUBECONFIG</code> to the newly created merged kubeconfig.
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Global terminal (Terminal 3)</span>
<span class="nb">export </span><span class="nv">KUBECONFIG</span><span class="o">=</span>./merged-kubeconfig.yaml
</code></pre></div>    </div>
  </li>
  <li>Finally execute the following command to connect the two clusters.</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Global terminal (Terminal 3)</span>
‚ûú cilium clustermesh connect <span class="se">\ </span>                    
  <span class="nt">--context</span> kind-us <span class="se">\</span>
  <span class="nt">--destination-context</span> kind-eu
‚ú® Extracting access information of cluster eu...
üîë Extracting secrets from cluster eu...
‚ö†Ô∏è  Service <span class="nb">type </span>NodePort detected! Service may fail when nodes are removed from the cluster!
‚ÑπÔ∏è  Found ClusterMesh service IPs: <span class="o">[</span>172.18.0.7]
‚ú® Extracting access information of cluster us...
üîë Extracting secrets from cluster us...
‚ö†Ô∏è  Service <span class="nb">type </span>NodePort detected! Service may fail when nodes are removed from the cluster!
‚ÑπÔ∏è  Found ClusterMesh service IPs: <span class="o">[</span>172.18.0.4]
‚ö†Ô∏è Cilium CA certificates <span class="k">do </span>not match between clusters. Multicluster features will be limited!
‚ÑπÔ∏è Configuring Cilium <span class="k">in </span>cluster <span class="s1">'kind-us'</span> to connect to cluster <span class="s1">'kind-eu'</span>
‚ÑπÔ∏è Configuring Cilium <span class="k">in </span>cluster <span class="s1">'kind-eu'</span> to connect to cluster <span class="s1">'kind-us'</span>
‚úÖ Connected cluster kind-us and kind-eu!

</code></pre></div></div>

<p>To check the status of the Cilium Cluster Mesh execute the command <code class="language-plaintext highlighter-rouge">cilium clustermesh status</code>. You would see an output like the following if everything is working as expected.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># US cluster (Terminal 1) &amp; EU cluster (Terminal 2)</span>
‚ûú cilium clustermesh status
‚ö†Ô∏è  Service <span class="nb">type </span>NodePort detected! Service may fail when nodes are removed from the cluster!
‚úÖ Service <span class="s2">"clustermesh-apiserver"</span> of <span class="nb">type</span> <span class="s2">"NodePort"</span> found
‚úÖ Cluster access information is available:
  - 172.18.0.4:32379
‚úÖ Deployment clustermesh-apiserver is ready
‚úÖ All 3 nodes are connected to all clusters <span class="o">[</span>min:1 / avg:1.0 / max:1]
üîå Cluster Connections:
  - eu: 3/3 configured, 3/3 connected
üîÄ Global services: <span class="o">[</span> min:0 / avg:0.0 / max:0 <span class="o">]</span>
</code></pre></div></div>

<h3 id="5-deploy-the-sample-hello-world-application">5. Deploy the sample hello world application</h3>

<p>Deploy the sample hello world application by executing the following commands in each of Terminal 1 (US) and Terminal 2(EU).</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># US cluster (Terminal 1)</span>
kubectl apply <span class="nt">-f</span> deployment-us.yaml

<span class="c"># EU cluster (Terminal 2)</span>
kubectl apply <span class="nt">-f</span> deployment-eu.yaml
</code></pre></div></div>

<p>Check whether sample hello world is working as expected by executing the following command in both US and EU clusters to invoke the hello world service from the busybox pod.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># US cluster (Terminal 1)</span>
‚ûú kubectl <span class="nb">exec</span> <span class="nt">-it</span> busybox-deployment-b7bc87c95-t4z2c <span class="nt">--</span> /bin/sh <span class="nt">-c</span> <span class="s1">'for i in $(seq 1 10); do wget -qO- hello-world:80; echo ""; done'</span>

<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>

<span class="c"># EU cluster (Terminal 2)</span>
‚ûú kubectl <span class="nb">exec</span> <span class="nt">-it</span> busybox-deployment-b7bc87c95-xhc6l <span class="nt">--</span> /bin/sh <span class="nt">-c</span> <span class="s1">'for i in $(seq 1 10); do wget -qO- hello-world:80; echo ""; done'</span>

<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
</code></pre></div></div>

<p>Did you notice that all the responses in the US are returned from the hello world service in US ? And all the responses in the EU are returned from the hello world service in EU ? Eventhough we have enabled Cilium Cluster Mesh in both clusters and connected the two clusters, we haven‚Äôt enabled the hello world service as a global service. So the requests are load balanced among the pods within the same cluster.</p>

<h3 id="6-enable-hello-world-service-as-a-global-service-to-enable-cross-cluster-service-discovery-and-load-balancing">6. Enable hello world service as a global service to enable cross cluster service discovery and load balancing.</h3>

<p>To enable hello world service as a global service, execute the following command in both US and EU clusters.</p>

<p align="center">
  <img alt="Kubernetes Custom Controllers" src="assets/images/multi-cluster-active.png" />
    <em>Cross cluster load balancing</em>
</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># US cluster (Terminal 1) &amp; EU cluster (Terminal 2)</span>
kubectl annotate service hello-world service.cilium.io/global<span class="o">=</span><span class="s2">"true"</span>
</code></pre></div></div>

<p>Now invoke the hello world service again and notice the responses received.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># US cluster (Terminal 1)</span>
‚ûú kubectl <span class="nb">exec</span> <span class="nt">-it</span> busybox-deployment-b7bc87c95-t4z2c <span class="nt">--</span> /bin/sh <span class="nt">-c</span> <span class="s1">'for i in $(seq 1 10); do wget -qO- hello-world:80; echo ""; done'</span>

<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>

<span class="c"># EU cluster (Terminal 2)</span>
‚ûú kubectl <span class="nb">exec</span> <span class="nt">-it</span> busybox-deployment-b7bc87c95-xhc6l <span class="nt">--</span> /bin/sh <span class="nt">-c</span> <span class="s1">'for i in $(seq 1 10); do wget -qO- hello-world:80; echo ""; done'</span>

<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
</code></pre></div></div>

<p>Now you can see that the requests from the US cluster are load balanced to US and EU and vice versa. Tadaaa!!! We have successfully enabled cross cluster service discovery and load balacing using Cilium Cluster Mesh.</p>

<p>Now in an ideal scenario, we want to load balance globally for fault tolerance only if the local services are not available. Load balancing cross cluster is not ideal always as the latency may get higher comapared to local services. To achive such behaviour, we can use the service affinity rules in Cilium.</p>

<h3 id="7-specify-hello-world-service-affinity-as-local-for-fault-tolerant-cross-cluster-load-balancing">7. Specify hello world service affinity as local for fault tolerant cross cluster load balancing.</h3>

<p>Execute the following command to specify the hello world service affinity as <code class="language-plaintext highlighter-rouge">local</code> in the US cluster. This will load balance requests to the hello world service among the pods in the US cluster only and route requests to the other cluster (EU) <strong>only if</strong> the local service is not available.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># US cluster (Terminal 1)</span>
kubectl annotate service hello-world service.cilium.io/affinity<span class="o">=</span><span class="s2">"local"</span>
</code></pre></div></div>

<p>Now if you invoke the hello world service from the US cluster, you will receive responses only from the hello world service in the US cluster.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># US cluster (Terminal 1)</span>
‚ûú kubectl <span class="nb">exec</span> <span class="nt">-it</span> busybox-deployment-b7bc87c95-t4z2c <span class="nt">--</span> /bin/sh <span class="nt">-c</span> <span class="s1">'for i in $(seq 1 10); do wget -qO- hello-world:80; echo ""; done'</span>

<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from US!"</span><span class="o">}</span>
</code></pre></div></div>

<p>To demonstrate the fault tolerant behaviour, scale down the hello world service in US cluster and invoke the hello world service from the US cluster.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># US cluster (Terminal 1)</span>
kubectl scale deployment hello-world <span class="nt">--replicas</span> 0
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># US cluster (Terminal 1)</span>
‚ûú kubectl <span class="nb">exec</span> <span class="nt">-it</span> busybox-deployment-b7bc87c95-t4z2c <span class="nt">--</span> /bin/sh <span class="nt">-c</span> <span class="s1">'for i in $(seq 1 10); do wget -qO- hello-world:80; echo ""; done'</span>

<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"message"</span>: <span class="s2">"Hello world from Europe!"</span><span class="o">}</span>
</code></pre></div></div>

<p align="center">
  <img alt="Kubernetes Custom Controllers" src="assets/images/multi-cluster-passive.png" />
    <em>Cross cluster fault tolerance</em>
</p>

<p>Eventhough the hello world service is down in the US, the requests get routed to the hello world service in EU making it fault tolerant across clusters.</p>

<p>So we have successfully demonstrated the multi cluster service discovery, load balancing and fault tolerance that can be achieved with Cilium Cluster Mesh using two kubernetes clusters running locally in your laptop.</p>

<p><strong>Kubernetes manifests used for the hands on lab:</strong> <a href="https://github.com/NomadXD/samples/tree/main/cilium-cluster-mesh">cilium-cluster-mesh</a></p>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://docs.cilium.io/en/stable/network/clustermesh/">Cilium Multi-cluster Networking</a></li>
  <li><a href="https://cilium.io/blog/2019/03/12/clustermesh/">Deep Dive into Cilium Multi-cluster</a></li>
  <li><a href="https://kind.sigs.k8s.io/docs/user/configuration/">KIND cluster configuration</a></li>
</ul>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            <!--  -->

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/blog/assets/images/lahiru.jpg" alt="lahiru" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/blog/author/lahiru">Lahiru Udayanga</a></h4>
                                
                                    <p>Greetings! I go by the name nomadxd on all of my digital channels. My real name is Lahiru Udayanga De Silva. I'm a software engineer by profession specialized in distributed systems, kubernetes and cloud native API management technologies.</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/blog/author/lahiru">Read More</a>
                        </div>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/blog//assets/images/blog-cover.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Nomad's Blog &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/blog/tag/tech/">Tech</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/blog/deep-dive-into-kubernetes-custom-controllers">Deep dive into Kubernetes custom controllers</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/blog/how-to-implement-a-k8s-operator-like-a-ninja">How to implement a K8s operator like a Ninja</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/blog/my-cka-story">How I passed my CKA exam on the first attempt</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/blog/tag/tech/">
                                
                                    See all 5 posts  ‚Üí
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/blog/from-sunset-to-sunrise">
                <div class="post-card-image" style="background-image: url(/blog/assets/images/blue-beach-island.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/blog/from-sunset-to-sunrise">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Travel</span>
                            
                        
                    

                    <h2 class="post-card-title">From Sunset to Sunrise....</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>Blue beach island is a small island located in the Nilwella area in between Dickwella and Tangalle. The island is known for its stunning sunsets and tranquil environment, making it an ideal spot</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                    
                        
                        <img class="author-profile-image" src="/blog/assets/images/lahiru.jpg" alt="Lahiru Udayanga" />
                        
                        <span class="post-card-author">
                            <a href="/blog/author/lahiru/">Lahiru Udayanga</a>
                        </span>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                <span class="reading-time">
                    
                    
                      3 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/blog/deep-dive-into-kubernetes-custom-controllers">
                <div class="post-card-image" style="background-image: url(/blog/assets/images/deep-dive-kubernetes-controllers-cover.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/blog/deep-dive-into-kubernetes-custom-controllers">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Tech</span>
                            
                        
                    

                    <h2 class="post-card-title">Deep dive into Kubernetes custom controllers</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>Kubernetes offers a rich ecosystem of extension points that allow developers to tailor and extend its functionality. Among these ability to implement Custom Controllers emerge as a powerful mechanism for extending Kubernetes with</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                    
                        
                        <img class="author-profile-image" src="/blog/assets/images/lahiru.jpg" alt="Lahiru Udayanga" />
                        
                        <span class="post-card-author">
                            <a href="/blog/author/lahiru/">Lahiru Udayanga</a>
                        </span>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                <span class="reading-time">
                    
                    
                      9 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="/blog/">
            
                <img src="/blog//assets/images/favicon.png" alt="Nomad's Blog icon" />
            
            <span>Nomad's Blog</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Multi cluster networking with Cilium Cluster Mesh</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Multi+cluster+networking+with+Cilium+Cluster+Mesh&amp;url=https://nomadxd.github.io/NomadXD/multi-cluster-networking-with-cilium-cluster-mesh"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://nomadxd.github.io/NomadXD/multi-cluster-networking-with-cilium-cluster-mesh"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="/blog/">Nomad's Blog</a> &copy; 2024</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyllt/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/blog/">Latest Posts</a>
                    <a href="https://facebook.com/lahiru97udayanga" target="_blank" rel="noopener">Facebook</a>
                    <a href="https://twitter.com/NomadXDDDD" target="_blank" rel="noopener">Twitter</a>
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/blog/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/blog/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
<!-- Google tag (gtag.js) -->
<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=G-C0VWGXL63G"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());

  gtag("config", "G-C0VWGXL63G");
</script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
